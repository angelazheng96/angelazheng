---
import "../styles/global.css";
import { Image } from "astro:assets";

const { filePath, description, location, date } = Astro.props;

const DATE_FMT = new Intl.DateTimeFormat("en-CA", {
  year: "numeric",
  month: "long",
  day: "numeric",
});

function formatDate(dateStr?: string) {
  if (!dateStr) return "";
  if (/^\d{4}$/.test(dateStr)) return dateStr;
  const m = /^(\d{4})-(\d{2})-(\d{2})$/.exec(dateStr);
  const d = m ? new Date(+m[1], +m[2] - 1, +m[3]) : new Date(dateStr);
  return Number.isNaN(d.getTime()) ? dateStr : DATE_FMT.format(d);
}
---

<div class="relative group rounded-lg overflow-hidden break-inside-avoid">
  <Image
    src={filePath}
    alt={description || "Gallery photo"}
    loading="lazy"
    class="rounded-lg block w-full h-auto"
  />
  <div
    class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col justify-center items-center text-white p-4 text-center"
  >
    {location && <div class="mb-1 text-md italic">{location}</div>}
    {date && <div class="text-xs">{formatDate(date)}</div>}
  </div>
</div>
